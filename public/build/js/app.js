let paso=1;const pasoInicial=1,pasoFinal=5;let paso2=1,categoria=1,containerId="";const categorias=["1","2","3"],orden={id:"",nombre:"",fecha:"",hora:"",mesa:"",productos:[]};function iniciarapp(){eventListeners(),mostrarSeccion(),tabs(),mostrarsubSeccion(),subtabs(),consultarDesayunos(),consultarBebidas(),consultarComidas(),consultarMesas(),idUsuario(),nombreUsuario(),fechaOrden(),horaOrden(),mesaOrden(),mostrarResumen()}function mostrarSeccion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar");const t="#paso-"+paso;document.querySelector(t).classList.add("mostrar");const o=document.querySelector(".actual");o&&o.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function mostrarsubSeccion(){const e=document.querySelector(".subMostrar");e&&e.classList.remove("subMostrar");const t="#paso2-"+paso2;document.querySelector(t).classList.add("subMostrar");const o=document.querySelector(".subActual");console.log(o),o&&o.classList.remove("subActual");document.querySelector(`[data-subpaso="${paso2}"]`).classList.add("subActual")}function tabs(){document.querySelectorAll(".tabs button").forEach(e=>{e.addEventListener("click",(function(e){paso=parseInt(e.target.dataset.paso),mostrarSeccion()}))})}function subtabs(){document.querySelectorAll(".tabsSubcategorias button").forEach(e=>{e.addEventListener("click",(function(e){paso2=parseInt(e.target.dataset.subpaso),mostrarsubSeccion()}))})}async function consultarDesayunos(){const e=location.origin+"/api/filtrar-huevos",t=location.origin+"/api/filtrar-omelettes",o=location.origin+"/api/filtrar-hotcakes",[n,a,r,c,s]=await Promise.allSettled([fetch(e),fetch(t),fetch(o),fetch(url4),fetch(url5)]),i=[n,a,r,c,s].filter(e=>"rejected"===e.status);if(i.length>0)return void console.error("Al menos una peticion falló:",i);const[d,l,u,m,p]=await Promise.all([n.value.json(),a.value.json(),r.value.json()]);filtrarProductos(d,"#Huevos"),filtrarProductos(l,"#Omelettes"),filtrarProductos(u,"#Hotcakes")}async function consultarBebidas(){const e=location.origin+"/api/filtrar-calientes",t=location.origin+"/api/filtrar-frias",[o,n]=await Promise.allSettled([fetch(e),fetch(t)]),a=[o,n].filter(e=>"rejected"===e.status);if(a.length>0)return void console.error("Al menos una peticion falló:",a);const[r,c]=await Promise.all([o.value.json(),n.value.json()]);filtrarProductos(r,"#bebidasCalientes"),filtrarProductos(c,"#bebidasFrias")}async function consultarComidas(){const e=location.origin+"/api/filtrar-carta",t=location.origin+"/api/filtrar-tortas",o=location.origin+"/api/filtrar-antojitos",[n,a,r]=await Promise.allSettled([fetch(e),fetch(t),fetch(o)]),c=[n,a,r].filter(e=>"rejected"===e.status);if(c.length>0)return void console.error("Al menos una peticion falló:",c);const[s,i,d]=await Promise.all([n.value.json(),a.value.json(),r.value.json()]);filtrarProductos(s,"#carta"),filtrarProductos(i,"#tortas"),filtrarProductos(d,"#antojitos")}async function consultarMesas(){const e=location.origin+"/api/mesas",t=await fetch(e);await t.json()}function createProductoElement(e,t){const{id:o,nombre:n,precio:a}=e,r=document.createElement("P");r.classList.add("nombre-producto"),r.textContent=n;const c=document.createElement("P");c.classList.add("precio-producto"),c.textContent="$"+a;const s=document.createElement("input");s.classList.add("cantidad-producto"),s.setAttribute("type","number"),s.setAttribute("min","1"),s.setAttribute("value","1"),s.addEventListener("input",(function(){actualizarCantidad(e,s),mostrarResumen()}));const i=document.createElement("DIV");i.classList.add("producto"),i.dataset.idProducto=o,i.onclick=function(t){t.target!==s&&(seleccionarProducto(e,s.value),mostrarResumen())},i.appendChild(r),i.appendChild(c),i.appendChild(s),document.querySelector(t).appendChild(i)}function filtrarProductos(e,t){e.forEach(e=>{createProductoElement(e,t)})}function seleccionarProducto(e,t){const{id:o}=e,{productos:n}=orden,a=document.querySelector(`[data-id-producto="${o}"]`);n.some(e=>e.id===o)?(orden.productos=n.filter(e=>e.id!==o),a.classList.remove("seleccionado")):isNaN(parseInt(t))||0!==parseInt(t)&&(orden.productos=[...n,{...e,cantidad:parseInt(t)}],a.classList.add("seleccionado"))}function eliminarProducto(e){const{id:t}=e,{productos:o}=orden,n=document.querySelector(`[data-id-producto="${t}"]`);o.some(e=>e.id===t)&&(orden.productos=o.filter(e=>e.id!==t),n.classList.remove("seleccionado"))}function actualizarCantidad(e,t){const{id:o}=e,{productos:n}=orden,a=parseInt(t.value);orden.productos=0!==a?n.map(e=>e.id===o?{...e,cantidad:a}:e):n.map(e=>e.id===o?{...e,cantidad:1}:e)}function ordenComentario(e,t){const{id:o}=t,{productos:n}=orden,a=e.value;""!==a.value?(orden.productos=n.map(e=>e.id===o?{...e,comentario:a}:e),console.log(orden.productos)):orden.productos=n.map(e=>e.id===o?{...e,comentario:"None"}:e)}function idUsuario(){const e=document.querySelector("#id").value;orden.id=e}function nombreUsuario(){const e=document.querySelector("#nombre").value;orden.nombre=e}function fechaOrden(){const e=new Date,t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();const a=`${t}-${"0"+o}-${"0"+n}`;orden.fecha=a}function mesaOrden(){const e=document.querySelector("#mesa").value;orden.mesa=parseInt(e)}function horaOrden(){const e=new Date,t=`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`.split(",");orden.hora=t}function mostrarResumen(){const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(orden).includes("")||0===orden.productos.length)return void mostrarAlerta("hacen falta agregar productos","error",".contenido-resumen",!1);const{productos:t}=orden,o=document.createElement("H3");o.textContent="Resumen de Productos",o.classList.add("tituloResumen"),e.appendChild(o);const n=document.createElement("DIV");n.classList.add("contenedor-barra");const a=document.createElement("P");a.textContent="Articulo",a.classList.add("Articulo");const r=document.createElement("P");r.textContent="Comentario";const c=document.createElement("P");c.textContent="Cant";const s=document.createElement("img");s.src="/build/img/gorro-de-cocinero.png",s.classList.add("orden-formato-imagen"),n.appendChild(c),n.appendChild(a),n.appendChild(r),n.appendChild(s),e.appendChild(n);let i=0;t.forEach(t=>{const{precio:o,nombre:n,cantidad:a,id:r}=t,c=parseInt(o);i+=c*a;const s=document.createElement("DIV");s.classList.add("contenedor-producto");const d=document.createElement("P");d.textContent=n,d.classList.add("Articulo");const l=document.createElement("P");l.innerHTML=" "+a;const u=document.createElement("INPUT");u.classList.add("orden-formato-comentario"),u.id="comentario",u.addEventListener("input",(function(){ordenComentario(u,t)}));const m=document.createElement("BUTTON");m.type="button",m.classList.add("botonEliminar"),m.textContent="X",m.value=r,m.onclick=function(){eliminarProducto(t),mostrarResumen()},s.appendChild(l),s.appendChild(d),s.appendChild(u),s.appendChild(m),e.appendChild(s)});const d=document.createElement("DIV");d.classList.add("total-producto");const l=document.createElement("P");l.innerHTML="Total: $"+i;const u=document.createElement("BUTTON");u.classList.add("boton"),u.textContent="Ordenar",u.onclick=ordenar,d.appendChild(u),d.appendChild(l),e.appendChild(d)}async function ordenar(){const{nombre:e,fecha:t,hora:o,productos:n,id:a,mesa:r}=orden,c=n.map(e=>e.id),s=n.map(e=>e.cantidad),i=n.map(e=>e.comentario),d=new FormData;d.append("fecha",t),d.append("hora",o),d.append("usuarioId",a),d.append("mesaId",r),d.append("productos",c),d.append("cantidades",s),d.append("comentarios",i),d.append("nombre",e),console.log([...d]);try{const e=location.origin+"/api/ordenes",t=await fetch(e,{method:"POST",body:d});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Orden Creada",text:"Tu Orden fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href=location.origin+"/mesas"},500)})}catch(e){Swal.fire({icon:"error",title:"error",text:"Hubo un error al guardar la Orden"})}}function mostrarAlerta(e,t,o,n=!0){const a=document.querySelector(".alerta");a&&a.remove();const r=document.createElement("DIV");r.textContent=e,r.classList.add("alerta"),r.classList.add(t);document.querySelector(o).appendChild(r),n&&setTimeout(()=>{r.remove()},3e3)}function eventListeners(){const e=document.querySelector(".alerta");console.log(e),setTimeout(()=>{e.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp()}));