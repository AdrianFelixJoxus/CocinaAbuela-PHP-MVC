let paso=1;const pasoInicial=1,pasoFinal=5;let paso2=1,categoria=1,containerId="";const categorias=["1","2","3"],orden={id:"",nombre:"",fecha:"",hora:"",mesa:"",productos:[]};function iniciarapp(){eventListeners(),mostrarSeccion(),tabs(),mostrarsubSeccion(),subtabs(),consultarDesayunos(),consultarBebidas(),consultarComidas(),consultarMesas(),idUsuario(),nombreUsuario(),fechaOrden(),horaOrden(),mesaOrden(),mostrarResumen()}function mostrarSeccion(){const t=document.querySelector(".mostrar");t&&t.classList.remove("mostrar");const e="#paso-"+paso;document.querySelector(e).classList.add("mostrar");const o=document.querySelector(".actual");o&&o.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function mostrarsubSeccion(){const t=document.querySelector(".subMostrar");t&&t.classList.remove("subMostrar");const e="#paso2-"+paso2;document.querySelector(e).classList.add("subMostrar");const o=document.querySelector(".subActual");console.log(o),o&&o.classList.remove("subActual");document.querySelector(`[data-subpaso="${paso2}"]`).classList.add("subActual")}function tabs(){document.querySelectorAll(".tabs button").forEach(t=>{t.addEventListener("click",(function(t){paso=parseInt(t.target.dataset.paso),mostrarSeccion()}))})}function subtabs(){document.querySelectorAll(".tabsSubcategorias button").forEach(t=>{t.addEventListener("click",(function(t){paso2=parseInt(t.target.dataset.subpaso),mostrarsubSeccion()}))})}async function consultarDesayunos(){const[t,e,o,a,n]=await Promise.allSettled([fetch("http://localhost:3000/api/filtrar-huevos"),fetch("http://localhost:3000/api/filtrar-omelettes"),fetch("http://localhost:3000/api/filtrar-hotcakes"),fetch("http://localhost:3000/api/filtrar-otros"),fetch("http://localhost:3000/api/filtrar-niños")]),r=[t,e,o,a,n].filter(t=>"rejected"===t.status);if(r.length>0)return void console.error("Al menos una peticion falló:",r);const[c,s,d,i,l]=await Promise.all([t.value.json(),e.value.json(),o.value.json(),a.value.json(),n.value.json()]);filtrarProductos(c,"#Huevos"),filtrarProductos(s,"#Omelettes"),filtrarProductos(d,"#Hotcakes"),filtrarProductos(i,"#Otros"),filtrarProductos(l,"#Niños")}async function consultarBebidas(){const[t,e]=await Promise.allSettled([fetch("http://localhost:3000/api/filtrar-calientes"),fetch("http://localhost:3000/api/filtrar-frias")]),o=[t,e].filter(t=>"rejected"===t.status);if(o.length>0)return void console.error("Al menos una peticion falló:",o);const[a,n]=await Promise.all([t.value.json(),e.value.json()]);filtrarProductos(a,"#bebidasCalientes"),filtrarProductos(n,"#bebidasFrias")}async function consultarComidas(){const[t,e,o]=await Promise.allSettled([fetch("http://localhost:3000/api/filtrar-carta"),fetch("http://localhost:3000/api/filtrar-tortas"),fetch("http://localhost:3000/api/filtrar-antojitos")]),a=[t,e,o].filter(t=>"rejected"===t.status);if(a.length>0)return void console.error("Al menos una peticion falló:",a);const[n,r,c]=await Promise.all([t.value.json(),e.value.json(),o.value.json()]);filtrarProductos(n,"#carta"),filtrarProductos(r,"#tortas"),filtrarProductos(c,"#antojitos")}async function consultarMesas(){const t=await fetch("http://localhost:3000/api/mesas");await t.json()}function createProductoElement(t,e){const{id:o,nombre:a,precio:n}=t,r=document.createElement("P");r.classList.add("nombre-producto"),r.textContent=a;const c=document.createElement("P");c.classList.add("precio-producto"),c.textContent="$"+n;const s=document.createElement("input");s.classList.add("cantidad-producto"),s.setAttribute("type","number"),s.setAttribute("min","1"),s.setAttribute("value","1"),s.addEventListener("input",(function(){actualizarCantidad(t,s),mostrarResumen()}));const d=document.createElement("DIV");d.classList.add("producto"),d.dataset.idProducto=o,d.onclick=function(e){e.target!==s&&(seleccionarProducto(t,s.value),mostrarResumen())},d.appendChild(r),d.appendChild(c),d.appendChild(s),document.querySelector(e).appendChild(d)}function filtrarProductos(t,e){t.forEach(t=>{createProductoElement(t,e)})}function seleccionarProducto(t,e){const{id:o}=t,{productos:a}=orden,n=document.querySelector(`[data-id-producto="${o}"]`);a.some(t=>t.id===o)?(orden.productos=a.filter(t=>t.id!==o),n.classList.remove("seleccionado")):isNaN(parseInt(e))||0!==parseInt(e)&&(orden.productos=[...a,{...t,cantidad:parseInt(e)}],n.classList.add("seleccionado"))}function eliminarProducto(t){const{id:e}=t,{productos:o}=orden,a=document.querySelector(`[data-id-producto="${e}"]`);o.some(t=>t.id===e)&&(orden.productos=o.filter(t=>t.id!==e),a.classList.remove("seleccionado"))}function actualizarCantidad(t,e){const{id:o}=t,{productos:a}=orden,n=parseInt(e.value);orden.productos=0!==n?a.map(t=>t.id===o?{...t,cantidad:n}:t):a.map(t=>t.id===o?{...t,cantidad:1}:t)}function ordenComentario(t,e){const{id:o}=e,{productos:a}=orden,n=t.value;""!==n.value?(orden.productos=a.map(t=>t.id===o?{...t,comentario:n}:t),console.log(orden.productos)):orden.productos=a.map(t=>t.id===o?{...t,comentario:"None"}:t)}function idUsuario(){const t=document.querySelector("#id").value;orden.id=t}function nombreUsuario(){const t=document.querySelector("#nombre").value;orden.nombre=t}function fechaOrden(){const t=new Date,e=t.getFullYear(),o=t.getMonth()+1,a=t.getDate();const n=`${e}-${"0"+o}-${"0"+a}`;orden.fecha=n}function mesaOrden(){const t=document.querySelector("#mesa").value;orden.mesa=parseInt(t)}function horaOrden(){const t=new Date,e=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`.split(",");orden.hora=e}function mostrarResumen(){const t=document.querySelector(".contenido-resumen");for(;t.firstChild;)t.removeChild(t.firstChild);if(Object.values(orden).includes("")||0===orden.productos.length)return void mostrarAlerta("hacen falta agregar productos","error",".contenido-resumen",!1);const{productos:e}=orden,o=document.createElement("H3");o.textContent="Resumen de Productos",o.classList.add("tituloResumen"),t.appendChild(o);const a=document.createElement("DIV");a.classList.add("contenedor-barra");const n=document.createElement("P");n.textContent="Articulo",n.classList.add("Articulo");const r=document.createElement("P");r.textContent="Comentario";const c=document.createElement("P");c.textContent="Cant";const s=document.createElement("img");s.src="/build/img/gorro-de-cocinero.png",s.classList.add("orden-formato-imagen"),a.appendChild(c),a.appendChild(n),a.appendChild(r),a.appendChild(s),t.appendChild(a);let d=0;e.forEach(e=>{const{precio:o,nombre:a,cantidad:n,id:r}=e,c=parseInt(o);d+=c*n;const s=document.createElement("DIV");s.classList.add("contenedor-producto");const i=document.createElement("P");i.textContent=a,i.classList.add("Articulo");const l=document.createElement("P");l.innerHTML=" "+n;const u=document.createElement("INPUT");u.classList.add("orden-formato-comentario"),u.id="comentario",u.addEventListener("input",(function(){ordenComentario(u,e)}));const m=document.createElement("BUTTON");m.type="button",m.classList.add("botonEliminar"),m.textContent="X",m.value=r,m.onclick=function(){eliminarProducto(e),mostrarResumen()},s.appendChild(l),s.appendChild(i),s.appendChild(u),s.appendChild(m),t.appendChild(s)});const i=document.createElement("DIV");i.classList.add("total-producto");const l=document.createElement("P");l.innerHTML="Total: $"+d;const u=document.createElement("BUTTON");u.classList.add("boton"),u.textContent="Ordenar",u.onclick=ordenar,i.appendChild(u),i.appendChild(l),t.appendChild(i)}async function ordenar(){const{nombre:t,fecha:e,hora:o,productos:a,id:n,mesa:r}=orden,c=a.map(t=>t.id),s=a.map(t=>t.cantidad),d=a.map(t=>t.comentario),i=new FormData;i.append("fecha",e),i.append("hora",o),i.append("usuarioId",n),i.append("mesaId",r),i.append("productos",c),i.append("cantidades",s),i.append("comentarios",d),i.append("nombre",t),console.log([...i]);try{const t="http://localhost:3000/api/ordenes",e=await fetch(t,{method:"POST",body:i});(await e.json()).resultado&&Swal.fire({icon:"success",title:"Orden Creada",text:"Tu Orden fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href="http://localhost:3000/mesas"},500)})}catch(t){Swal.fire({icon:"error",title:"error",text:"Hubo un error al guardar la Orden"})}}function mostrarAlerta(t,e,o,a=!0){const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.textContent=t,r.classList.add("alerta"),r.classList.add(e);document.querySelector(o).appendChild(r),a&&setTimeout(()=>{r.remove()},3e3)}function eventListeners(){const t=document.querySelector(".alerta");console.log(t),setTimeout(()=>{t.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp()}));