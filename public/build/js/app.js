let paso=1;const pasoInicial=1,pasoFinal=5;let paso2=1,categoria=1,containerId="";const categorias=["1","2","3"],orden={id:"",nombre:"",fecha:"",hora:"",mesa:"",productos:[]};function iniciarapp(){eventListeners(),mostrarSeccion(),tabs(),mostrarsubSeccion(),subtabs(),consultarDesayunos(),consultarBebidas(),consultarComidas(),consultarMesas(),idUsuario(),nombreUsuario(),fechaOrden(),horaOrden(),mesaOrden(),mostrarResumen()}function mostrarSeccion(){const t=document.querySelector(".mostrar");t&&t.classList.remove("mostrar");const e="#paso-"+paso;document.querySelector(e).classList.add("mostrar");const o=document.querySelector(".actual");o&&o.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function mostrarsubSeccion(){const t=document.querySelector(".subMostrar");t&&t.classList.remove("subMostrar");const e="#paso2-"+paso2;document.querySelector(e).classList.add("subMostrar");const o=document.querySelector(".subActual");console.log(o),o&&o.classList.remove("subActual");document.querySelector(`[data-subpaso="${paso2}"]`).classList.add("subActual")}function tabs(){document.querySelectorAll(".tabs button").forEach(t=>{t.addEventListener("click",(function(t){paso=parseInt(t.target.dataset.paso),mostrarSeccion()}))})}function subtabs(){document.querySelectorAll(".tabsSubcategorias button").forEach(t=>{t.addEventListener("click",(function(t){paso2=parseInt(t.target.dataset.subpaso),mostrarsubSeccion()}))})}async function consultarDesayunos(){const t=location.origin+"/api/filtrar-huevos",e=location.origin+"/api/filtrar-omelettes",o=location.origin+"/api/filtrar-hotcakes",n=location.origin+"/api/filtrar-otros",a=location.origin+"/api/filtrar-niños",[r,c,s,i,d]=await Promise.allSettled([fetch(t),fetch(e),fetch(o),fetch(n),fetch(a)]),l=[r,c,s,i,d].filter(t=>"rejected"===t.status);if(l.length>0)return void console.error("Al menos una peticion falló:",l);const[u,m,p,f,h]=await Promise.all([r.value.json(),c.value.json(),s.value.json(),i.value.json(),d.value.json()]);filtrarProductos(u,"#Huevos"),filtrarProductos(m,"#Omelettes"),filtrarProductos(p,"#Hotcakes"),filtrarProductos(f,"#Otros"),filtrarProductos(h,"#Niños")}async function consultarBebidas(){const t=location.origin+"/api/filtrar-calientes",e=location.origin+"/api/filtrar-frias",[o,n]=await Promise.allSettled([fetch(t),fetch(e)]),a=[o,n].filter(t=>"rejected"===t.status);if(a.length>0)return void console.error("Al menos una peticion falló:",a);const[r,c]=await Promise.all([o.value.json(),n.value.json()]);filtrarProductos(r,"#bebidasCalientes"),filtrarProductos(c,"#bebidasFrias")}async function consultarComidas(){const t=location.origin+"/api/filtrar-carta",e=location.origin+"/api/filtrar-tortas",o=location.origin+"/api/filtrar-antojitos",[n,a,r]=await Promise.allSettled([fetch(t),fetch(e),fetch(o)]),c=[n,a,r].filter(t=>"rejected"===t.status);if(c.length>0)return void console.error("Al menos una peticion falló:",c);const[s,i,d]=await Promise.all([n.value.json(),a.value.json(),r.value.json()]);filtrarProductos(s,"#carta"),filtrarProductos(i,"#tortas"),filtrarProductos(d,"#antojitos")}async function consultarMesas(){const t=location.origin+"/api/mesas",e=await fetch(t);await e.json()}function createProductoElement(t,e){const{id:o,nombre:n,precio:a}=t,r=document.createElement("P");r.classList.add("nombre-producto"),r.textContent=n;const c=document.createElement("P");c.classList.add("precio-producto"),c.textContent="$"+a;const s=document.createElement("input");s.classList.add("cantidad-producto"),s.setAttribute("type","number"),s.setAttribute("min","1"),s.setAttribute("value","1"),s.addEventListener("input",(function(){actualizarCantidad(t,s),mostrarResumen()}));const i=document.createElement("DIV");i.classList.add("producto"),i.dataset.idProducto=o,i.onclick=function(e){e.target!==s&&(seleccionarProducto(t,s.value),mostrarResumen())},i.appendChild(r),i.appendChild(c),i.appendChild(s),document.querySelector(e).appendChild(i)}function filtrarProductos(t,e){t.forEach(t=>{createProductoElement(t,e)})}function seleccionarProducto(t,e){const{id:o}=t,{productos:n}=orden,a=document.querySelector(`[data-id-producto="${o}"]`);n.some(t=>t.id===o)?(orden.productos=n.filter(t=>t.id!==o),a.classList.remove("seleccionado")):isNaN(parseInt(e))||0!==parseInt(e)&&(orden.productos=[...n,{...t,cantidad:parseInt(e)}],a.classList.add("seleccionado"))}function eliminarProducto(t){const{id:e}=t,{productos:o}=orden,n=document.querySelector(`[data-id-producto="${e}"]`);o.some(t=>t.id===e)&&(orden.productos=o.filter(t=>t.id!==e),n.classList.remove("seleccionado"))}function actualizarCantidad(t,e){const{id:o}=t,{productos:n}=orden,a=parseInt(e.value);orden.productos=0!==a?n.map(t=>t.id===o?{...t,cantidad:a}:t):n.map(t=>t.id===o?{...t,cantidad:1}:t)}function ordenComentario(t,e){const{id:o}=e,{productos:n}=orden,a=t.value;""!==a.value?(orden.productos=n.map(t=>t.id===o?{...t,comentario:a}:t),console.log(orden.productos)):orden.productos=n.map(t=>t.id===o?{...t,comentario:"None"}:t)}function idUsuario(){const t=document.querySelector("#id").value;orden.id=t}function nombreUsuario(){const t=document.querySelector("#nombre").value;orden.nombre=t}function fechaOrden(){const t=new Date,e=t.getFullYear(),o=t.getMonth()+1,n=t.getDate();const a=`${e}-${"0"+o}-${"0"+n}`;orden.fecha=a}function mesaOrden(){const t=document.querySelector("#mesa").value;orden.mesa=parseInt(t)}function horaOrden(){const t=new Date,e=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`.split(",");orden.hora=e}function mostrarResumen(){const t=document.querySelector(".contenido-resumen");for(;t.firstChild;)t.removeChild(t.firstChild);if(Object.values(orden).includes("")||0===orden.productos.length)return void mostrarAlerta("hacen falta agregar productos","error",".contenido-resumen",!1);const{productos:e}=orden,o=document.createElement("H3");o.textContent="Resumen de Productos",o.classList.add("tituloResumen"),t.appendChild(o);const n=document.createElement("DIV");n.classList.add("contenedor-barra");const a=document.createElement("P");a.textContent="Articulo",a.classList.add("Articulo");const r=document.createElement("P");r.textContent="Comentario";const c=document.createElement("P");c.textContent="Cant";const s=document.createElement("img");s.src="/build/img/gorro-de-cocinero.png",s.classList.add("orden-formato-imagen"),n.appendChild(c),n.appendChild(a),n.appendChild(r),n.appendChild(s),t.appendChild(n);let i=0;e.forEach(e=>{const{precio:o,nombre:n,cantidad:a,id:r}=e,c=parseInt(o);i+=c*a;const s=document.createElement("DIV");s.classList.add("contenedor-producto");const d=document.createElement("P");d.textContent=n,d.classList.add("Articulo");const l=document.createElement("P");l.innerHTML=" "+a;const u=document.createElement("INPUT");u.classList.add("orden-formato-comentario"),u.id="comentario",u.addEventListener("input",(function(){ordenComentario(u,e)}));const m=document.createElement("BUTTON");m.type="button",m.classList.add("botonEliminar"),m.textContent="X",m.value=r,m.onclick=function(){eliminarProducto(e),mostrarResumen()},s.appendChild(l),s.appendChild(d),s.appendChild(u),s.appendChild(m),t.appendChild(s)});const d=document.createElement("DIV");d.classList.add("total-producto");const l=document.createElement("P");l.innerHTML="Total: $"+i;const u=document.createElement("BUTTON");u.classList.add("boton"),u.textContent="Ordenar",u.onclick=ordenar,d.appendChild(u),d.appendChild(l),t.appendChild(d)}async function ordenar(){const{nombre:t,fecha:e,hora:o,productos:n,id:a,mesa:r}=orden,c=n.map(t=>t.id),s=n.map(t=>t.cantidad),i=n.map(t=>t.comentario),d=new FormData;d.append("fecha",e),d.append("hora",o),d.append("usuarioId",a),d.append("mesaId",r),d.append("productos",c),d.append("cantidades",s),d.append("comentarios",i),d.append("nombre",t),console.log([...d]);try{const t=location.origin+"/api/ordenes",e=await fetch(t,{method:"POST",body:d});(await e.json()).resultado&&Swal.fire({icon:"success",title:"Orden Creada",text:"Tu Orden fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href=location.origin+"/mesas"},500)})}catch(t){Swal.fire({icon:"error",title:"error",text:"Hubo un error al guardar la Orden"})}}function mostrarAlerta(t,e,o,n=!0){const a=document.querySelector(".alerta");a&&a.remove();const r=document.createElement("DIV");r.textContent=t,r.classList.add("alerta"),r.classList.add(e);document.querySelector(o).appendChild(r),n&&setTimeout(()=>{r.remove()},3e3)}function eventListeners(){const t=document.querySelector(".alerta");console.log(t),setTimeout(()=>{t.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp()}));