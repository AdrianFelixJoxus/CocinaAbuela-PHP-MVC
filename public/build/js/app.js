let paso=1;const pasoInicial=1,pasoFinal=5;let paso2=1,categoria=1,containerId="";const categorias=["1","2","3"],orden={id:"",nombre:"",fecha:"",hora:"",mesa:"",productos:[]};function iniciarapp(){eventListeners(),mostrarSeccion(),tabs(),mostrarsubSeccion(),subtabs(),consultarDesayunos(),consultarBebidas(),consultarComidas(),consultarMesas(),idUsuario(),nombreUsuario(),fechaOrden(),horaOrden(),mesaOrden(),mostrarResumen()}function mostrarSeccion(){const t=document.querySelector(".mostrar");t&&t.classList.remove("mostrar");const e="#paso-"+paso;document.querySelector(e).classList.add("mostrar");const o=document.querySelector(".actual");o&&o.classList.remove("actual");document.querySelector(`[data-paso="${paso}"]`).classList.add("actual")}function mostrarsubSeccion(){const t=document.querySelector(".subMostrar");t&&t.classList.remove("subMostrar");const e="#paso2-"+paso2;document.querySelector(e).classList.add("subMostrar");const o=document.querySelector(".subActual");console.log(o),o&&o.classList.remove("subActual");document.querySelector(`[data-subpaso="${paso2}"]`).classList.add("subActual")}function tabs(){document.querySelectorAll(".tabs button").forEach(t=>{t.addEventListener("click",(function(t){paso=parseInt(t.target.dataset.paso),mostrarSeccion()}))})}function subtabs(){document.querySelectorAll(".tabsSubcategorias button").forEach(t=>{t.addEventListener("click",(function(t){paso2=parseInt(t.target.dataset.subpaso),mostrarsubSeccion()}))})}async function consultarDesayunos(){const t=location.origin+"/api/filtrar-huevos",e=location.origin+"/api/filtrar-omelettes",o=location.origin+"/api/filtrar-hotcakes",a=location.origin+"/api/filtrar-otros",n=location.origin+"/api/filtrar-ninos";try{const[r,s,c,i,d]=await Promise.allSettled([fetch(t).then(t=>t.ok?t:Promise.reject({status:t.status,statusText:t.statusText})),fetch(e).then(t=>t.ok?t:Promise.reject({status:t.status,statusText:t.statusText})),fetch(o).then(t=>t.ok?t:Promise.reject({status:t.status,statusText:t.statusText})),fetch(a).then(t=>t.ok?t:Promise.reject({status:t.status,statusText:t.statusText})),fetch(n).then(t=>t.ok?t:Promise.reject({status:t.status,statusText:t.statusText}))]),u=[r,s,c,i,d].filter(t=>"rejected"===t.status);if(u.length>0)return void u.forEach(t=>{console.error(`Petici칩n fallida: ${t.reason.status} - ${t.reason.statusText}`)});const[l,m,p,f,h]=await Promise.all([r.value.json(),s.value.json(),c.value.json(),i.value.json(),d.value.json()]);filtrarProductos(l,"#Huevos"),filtrarProductos(m,"#Omelettes"),filtrarProductos(p,"#Hotcakes"),filtrarProductos(f,"#Otros"),filtrarProductos(h,"#Ni침os")}catch(t){console.log("Error al consultar desayunos: ",t)}}async function consultarBebidas(){const t=location.origin+"/api/filtrar-calientes",e=location.origin+"/api/filtrar-frias",[o,a]=await Promise.allSettled([fetch(t),fetch(e)]),n=[o,a].filter(t=>"rejected"===t.status);if(n.length>0)return void console.error("Al menos una peticion fall칩:",n);const[r,s]=await Promise.all([o.value.json(),a.value.json()]);filtrarProductos(r,"#bebidasCalientes"),filtrarProductos(s,"#bebidasFrias")}async function consultarComidas(){const t=location.origin+"/api/filtrar-carta",e=location.origin+"/api/filtrar-tortas",o=location.origin+"/api/filtrar-antojitos",[a,n,r]=await Promise.allSettled([fetch(t),fetch(e),fetch(o)]),s=[a,n,r].filter(t=>"rejected"===t.status);if(s.length>0)return void console.error("Al menos una peticion fall칩:",s);const[c,i,d]=await Promise.all([a.value.json(),n.value.json(),r.value.json()]);filtrarProductos(c,"#carta"),filtrarProductos(i,"#tortas"),filtrarProductos(d,"#antojitos")}async function consultarMesas(){const t=location.origin+"/api/mesas",e=await fetch(t);await e.json()}function createProductoElement(t,e){const{id:o,nombre:a,precio:n}=t,r=document.createElement("P");r.classList.add("nombre-producto"),r.textContent=a;const s=document.createElement("P");s.classList.add("precio-producto"),s.textContent="$"+n;const c=document.createElement("input");c.classList.add("cantidad-producto"),c.setAttribute("type","number"),c.setAttribute("min","1"),c.setAttribute("value","1"),c.addEventListener("input",(function(){actualizarCantidad(t,c),mostrarResumen()}));const i=document.createElement("DIV");i.classList.add("producto"),i.dataset.idProducto=o,i.onclick=function(e){e.target!==c&&(seleccionarProducto(t,c.value),mostrarResumen())},i.appendChild(r),i.appendChild(s),i.appendChild(c),document.querySelector(e).appendChild(i)}function filtrarProductos(t,e){t.forEach(t=>{createProductoElement(t,e)})}function seleccionarProducto(t,e){const{id:o}=t,{productos:a}=orden,n=document.querySelector(`[data-id-producto="${o}"]`);a.some(t=>t.id===o)?(orden.productos=a.filter(t=>t.id!==o),n.classList.remove("seleccionado")):isNaN(parseInt(e))||0!==parseInt(e)&&(orden.productos=[...a,{...t,cantidad:parseInt(e)}],n.classList.add("seleccionado"))}function eliminarProducto(t){const{id:e}=t,{productos:o}=orden,a=document.querySelector(`[data-id-producto="${e}"]`);o.some(t=>t.id===e)&&(orden.productos=o.filter(t=>t.id!==e),a.classList.remove("seleccionado"))}function actualizarCantidad(t,e){const{id:o}=t,{productos:a}=orden,n=parseInt(e.value);orden.productos=0!==n?a.map(t=>t.id===o?{...t,cantidad:n}:t):a.map(t=>t.id===o?{...t,cantidad:1}:t)}function ordenComentario(t,e){const{id:o}=e,{productos:a}=orden,n=t.value;""!==n.value?(orden.productos=a.map(t=>t.id===o?{...t,comentario:n}:t),console.log(orden.productos)):orden.productos=a.map(t=>t.id===o?{...t,comentario:"None"}:t)}function idUsuario(){const t=document.querySelector("#id").value;orden.id=t}function nombreUsuario(){const t=document.querySelector("#nombre").value;orden.nombre=t}function fechaOrden(){const t=new Date,e=t.getFullYear(),o=t.getMonth()+1,a=t.getDate();const n=`${e}-${"0"+o}-${"0"+a}`;orden.fecha=n}function mesaOrden(){const t=document.querySelector("#mesa").value;orden.mesa=parseInt(t)}function horaOrden(){const t=new Date,e=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`.split(",");orden.hora=e}function mostrarResumen(){const t=document.querySelector(".contenido-resumen");for(;t.firstChild;)t.removeChild(t.firstChild);if(Object.values(orden).includes("")||0===orden.productos.length)return void mostrarAlerta("hacen falta agregar productos","error",".contenido-resumen",!1);const{productos:e}=orden,o=document.createElement("H3");o.textContent="Resumen de Productos",o.classList.add("tituloResumen"),t.appendChild(o);const a=document.createElement("DIV");a.classList.add("contenedor-barra");const n=document.createElement("P");n.textContent="Articulo",n.classList.add("Articulo");const r=document.createElement("P");r.textContent="Comentario";const s=document.createElement("P");s.textContent="Cant";const c=document.createElement("img");c.src="/build/img/gorro-de-cocinero.png",c.classList.add("orden-formato-imagen"),a.appendChild(s),a.appendChild(n),a.appendChild(r),a.appendChild(c),t.appendChild(a);let i=0;e.forEach(e=>{const{precio:o,nombre:a,cantidad:n,id:r}=e,s=parseInt(o);i+=s*n;const c=document.createElement("DIV");c.classList.add("contenedor-producto");const d=document.createElement("P");d.textContent=a,d.classList.add("Articulo");const u=document.createElement("P");u.innerHTML=" "+n;const l=document.createElement("INPUT");l.classList.add("orden-formato-comentario"),l.id="comentario",l.addEventListener("input",(function(){ordenComentario(l,e)}));const m=document.createElement("BUTTON");m.type="button",m.classList.add("botonEliminar"),m.textContent="X",m.value=r,m.onclick=function(){eliminarProducto(e),mostrarResumen()},c.appendChild(u),c.appendChild(d),c.appendChild(l),c.appendChild(m),t.appendChild(c)});const d=document.createElement("DIV");d.classList.add("total-producto");const u=document.createElement("P");u.innerHTML="Total: $"+i;const l=document.createElement("BUTTON");l.classList.add("boton"),l.textContent="Ordenar",l.onclick=ordenar,d.appendChild(l),d.appendChild(u),t.appendChild(d)}async function ordenar(){const{nombre:t,fecha:e,hora:o,productos:a,id:n,mesa:r}=orden,s=a.map(t=>t.id),c=a.map(t=>t.cantidad),i=a.map(t=>t.comentario),d=new FormData;d.append("fecha",e),d.append("hora",o),d.append("usuarioId",n),d.append("mesaId",r),d.append("productos",s),d.append("cantidades",c),d.append("comentarios",i),d.append("nombre",t),console.log([...d]);try{const t=location.origin+"/api/ordenes",e=await fetch(t,{method:"POST",body:d});(await e.json()).resultado&&Swal.fire({icon:"success",title:"Orden Creada",text:"Tu Orden fue creada correctamente",button:"OK"}).then(()=>{setTimeout(()=>{window.location.href=location.origin+"/mesas"},500)})}catch(t){Swal.fire({icon:"error",title:"error",text:"Hubo un error al guardar la Orden"})}}function mostrarAlerta(t,e,o,a=!0){const n=document.querySelector(".alerta");n&&n.remove();const r=document.createElement("DIV");r.textContent=t,r.classList.add("alerta"),r.classList.add(e);document.querySelector(o).appendChild(r),a&&setTimeout(()=>{r.remove()},3e3)}function eventListeners(){const t=document.querySelector(".alerta");console.log(t),setTimeout(()=>{t.remove()},3e3)}document.addEventListener("DOMContentLoaded",(function(){iniciarapp()}));